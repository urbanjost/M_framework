<html> 
<head> 
<title> </title>
<style> 
px {font-family: "Lucida Console", Monaco, monospace }
p { font-size:100%; line-height:1.1em; }
body {xfont-style: sans-serif}
body {
color:#333; font-family:Verdana, Arial, Helvetica, sans-serif; font-size:1em; line-height:1.3em; }
a:visited { color:#666; }
h1,h2,h3,h4,h5,h6 { color:#333; font-family:georgia, verdana, sans-serif; }
h1 { font-size:150%; page-break-before:auto;background-color: #aaaaff}
h2 { font-size:143%;color:teal; }
h3 { font-size:134%;color:blue; }
h4 { font-size:120%;color:gray; }
img { max-width: 55em}
p{ padding: 0;margin:0; }
p{ padding-right:1.4em; }
p{ padding-bottom:0.1em; }
p{ padding-top:1em; }
p{ whitespace: pre-wrap; }
h5,h6 { font-size:100% }
a.nav,a:link.nav, a:visited.nav { background-color:#FFF; color:#000; }
XXtable { border:double #000; border-collapse:collapse; }
XXtable { border-collapse:collapse; }
XXtd { border:thin solid #888; }
XXtd { border:none; }
li { margin-bottom:0.5em; }
blockquote { display:block; font-size:100%; line-height:1.1em; margin:0 0 0.5em; padding:0 2.5em; }
pre { background-color:#DDD; font-size:100%; overflow:auto; padding:1em; }
a,li span { color:#000; }
a:hover, a.nav:hover, a:hover math { background-color:#000; color:#FFF; }
#Container { margin:0 10px; text-align:center; background-color: #BBB}
#Content { border-top:none; margin:auto; padding:0.3em; text-align:left; width:100%; max-width:55em; background:#FFF}
span.webName { font-size:.5em; }
textarea#content { font-size: 1em; line-height: 1.125; }
h1#pageName { line-height:1em; margin:0.2em 0 0.2em 0; padding:0; }
.property { color:#666; font-size:100%; }
a.existingWikiWord[title]{ //border: 1px dashed #BBB; }
.byline { color:#666; font-size:1.0em; font-style:italic; margin-bottom:1em; padding-top:1px; } 
</style> 
</head>
<BODY bgcolor=#F0F0F0 text=#000000 link=#0000ff vlink=#C000C0 alink=#ff0000><A NAME=top></A>
<!--
<h5><a href="https://github.com/urbanjost/M_framework__verify">[UP]</a></h5>
<button type="button" onclick="javascript:history.back()">Back</button>
-->
<div id="Container">
<div id="Content">
<CENTER>
<H1><HR><I>Manual Reference Pages &nbsp;-&nbsp;</I><NOBR>M_framework__verify (3m_framework__verify)</NOBR><HR></H1>
</CENTER>
<A name=0>

     <H3>NAME</H3>

</A>
<BLOCKQUOTE>
M_framework__verify(3fm) - [M_framework__verify::INTRO] unit test framework
(LICENSE:PD)
</BLOCKQUOTE>
<A name=contents></A><H3>CONTENTS</H3></A>
<BLOCKQUOTE>
<A HREF=#1>Synopsis</A><BR>
<A HREF=#2>Quote</A><BR>
<A HREF=#3>Description</A><BR>
<A HREF=#4>Examples</A><BR>
<A HREF=#5>Author</A><BR>
<A HREF=#6>License</A><BR>
</BLOCKQUOTE>
<A name=7>

     <H3>SYNOPSIS</H3>

</A>
<BLOCKQUOTE>
<P>
Module procedures
<P>
<PRE>
   use M_framework__verify, only : unit_check, unit_check_start,     &
                                   unit_check_end, unit_check_stop, &
                                   unit_check_good, unit_check_bad,  &
                                   unit_check_msg, unit_check_mode,  &
                                   unit_check_system
</PRE>
Module values
<P>
<PRE>
   use M_framework__verify, only : unit_check_level, unit_check_flags
<P>
</PRE>
</BLOCKQUOTE>
<A name=2>

     <H3>QUOTE</H3>

</A>
<BLOCKQUOTE>
Do not let your victories go to your head, nor let your failures go
to your heart.
</BLOCKQUOTE>
<A name=3>

     <H3>DESCRIPTION</H3>

</A>
<BLOCKQUOTE>
The M_framework(3f) module is a collection of Fortran routines for
supporting code development by providing logging, error processing,
debugging, comparison and unit testing.
<P>
The M_framework__verify(3fm) module specifically brings together a
few procedures for creating unit testing. It &#46;&#46;&#46;
<BLOCKQUOTE>
<TABLE cellpadding=3><!-- tsb: The M_framework__verify(3fm) module specifically brings together a
 -->
<TR></TR><TR></TR>
<TR valign=top><TD width=3%>
o
</TD><TD>
allows for a user-defined command to be called to collect results or
produce mail alerts, or other custom bookkeeping operations.
</TD></TR>
<TR valign=top><TD width=3%>
o
</TD><TD>
supports easily composing a message from up to twenty scalar
scalar intrinsic values and different strings
</TD></TR>
<TR valign=top><TD width=3%>
o
</TD><TD>
allows stopping on failure or continuing
</TD></TR>
<TR valign=top><TD width=3%>
o
</TD><TD>
provides for a non-zero exit code if any tests fail
</TD></TR>
<TR valign=top><TD width=3%>
o
</TD><TD>
is designed with integration with the fpm( the Fortran Package Manager)
test subcommand.
</TD></TR>
<TR></TR></TABLE></BLOCKQUOTE>
<P>
If default modes need changed it can be done via the unit_check_mode(3f)
procedure or as command line options.
<P>
messages by default are writting to stderr, but may be written to any
list of LUNs of preassigned or open files.
</BLOCKQUOTE>
<A name=>

    <H4>&nbsp; &nbsp; SET MODES</H4>
</A>
<BLOCKQUOTE>
<P>
Some of the most common options are
<P>
<PRE>
      call unit_check_mode(command,keep_going,level,luns=[K,L,M,N,&#46;&#46;&#46;])
<P>
       keep_going  logical variable that can be used to turn on or off
                   program termination on errors.
       luns        array of Fortran LUNs to write messages to
       level       An integer that can be used to specify
                   different debug levels
       command     name of optional command to execute for a start,
                   check, or finish.
<P>
</PRE>
</BLOCKQUOTE>
<A name=>

    <H4>&nbsp; &nbsp; PROCEDURES</H4>
</A>
<BLOCKQUOTE>
<P>
<TABLE cellpadding=3>
<TR valign=top><TD colspan=2>
<B>unit_check_start</B> </TD></TR><TR valign=top><TD width=6%>&nbsp;</TD><TD>
start tests of a procedure
</TD></TR>
<TR valign=top><TD colspan=2>
<B>unit_check</B> </TD></TR><TR valign=top><TD width=6%>&nbsp;</TD><TD>
report if expression is false or true
and if .false. stop program when keep_going=.false.
</TD></TR>
<TR valign=top><TD colspan=2>
<B>unit_check_end</B> </TD></TR><TR valign=top><TD width=6%>&nbsp;</TD><TD>
ends test of a procedure
</TD></TR>
<TR valign=top><TD colspan=2>
<B>unit_check_stop</B> </TD></TR><TR valign=top><TD width=6%>&nbsp;</TD><TD>
stop program with exit value of 0 if no failures
else with an exit value of 1
</TD></TR>
<TR valign=top><TD colspan=2>
<B>unit_check_good</B> </TD></TR><TR valign=top><TD width=6%>&nbsp;</TD><TD>
shorthand for "unit_check(&#146;name&#146;,.true., &#46;&#46;&#46;.)
</TD></TR>
<TR valign=top><TD colspan=2>
<B>unit_check_bad</B> </TD></TR><TR valign=top><TD width=6%>&nbsp;</TD><TD>
shorthand for "unit_check(&#146;name&#146;,.false., &#46;&#46;&#46;.)
</TD></TR>
<TR valign=top><TD colspan=2>
<B>unit_check_msg</B> </TD></TR><TR valign=top><TD width=6%>&nbsp;</TD><TD>
write message
</TD></TR>
<TR valign=top><TD colspan=2>
<B>unit_check_system</B> </TD></TR><TR valign=top><TD width=6%>&nbsp;</TD><TD>
execute system command, recursively if requested.
</TD></TR>
<TR></TR></TABLE>For custom unit testing reports, a command can be given that will be
passed information on the command line in NAMELIST format.
<P>
This command is generally a script that makes entries for each unit,
perhaps in an SQLite data file for example.
<P>
It might also send an email if a test fails in batch environments.
<P>
It could also convert the information to CSV for use in spreadsheets,
or generate an HTML report, for example.
<P>
A sample command written in the bash(1) shell and using the sqlite3(1)
command should be included in this distribution as an example.
<P>
The flexibility introduced by calling an external script or program
is that The command can be changed as desired with changing the test
programs.
</BLOCKQUOTE>
<A name=>

    <H4>&nbsp; &nbsp; RELATED FUNCTIONS</H4>
</A>
<BLOCKQUOTE>
<P>
The routines in M_framework__verify(3f) are often combined with the
M_hashkeys(3fm) routines and various math and statistical routines
to quickly create unit tests.
<P>
Comparisons of real values can be done with a tolerance with
M_Compare_Float_Numbers(3f) and M_framework__approx(3f), for example.
<P>
The intrinsics ANY(3f) and ALL(3f) are particularly useful in calls
to unit_check(3f).
</BLOCKQUOTE>
<A name=4>

     <H3>EXAMPLES</H3>

</A>
<BLOCKQUOTE>
Sample program
<P>
<PRE>
    !! program demo_M_framework__verify
    module M_framework__demo
    ! create a few procedures to test
    private
    public one ! some regular routine
    public two ! some regular routine
    public test_suite_M_demo ! special name for use with test_suite(1bash).
    contains
<P>
    subroutine one()
    end subroutine one
<P>
    subroutine two()
    end subroutine two
<P>
    !! unit test
    subroutine test_suite_M_demo
    use M_framework__verify, only: unit_check_start, unit_check
    use M_framework__verify, only: unit_check_good, unit_check_bad, &
            & unit_check_end
    use M_framework__verify, only: unit_check_msg, unit_check_stop, &
            & unit_check_system
    implicit none
    integer :: i, j, k
    integer,allocatable :: array(:)
    integer :: arr(4)=[21,51,14,45]
    integer :: a=21, b=51, c=14, d=45
    ! TEST-DRIVEN DEVELOPMENT
    ! optional set-up       perform initialization operations common to
    !                       all tests within a module
       i=1
       j=2
       k=3
       array=[10,20,30,40,50,60,70]
       call test_one()
       call test_two()
    ! optional tear-down    perform finalization operations common to
    !                       all tests within a module
    contains
<P>
    subroutine test_one()
    !  register an entry for specified name ("one") in database
    ! with status of zero (0)
    call unit_check_start(&#146;one&#146;)
<P>
    !  if mask test fails, can
    !  * produce a SUCCESS: or FAIL: message and stop program
    !  * change database status for specified entry to -1 and
    !    stop program, else continue
    !  * produce a SUCCESS: or FAIL: message and keep going
    !  * produce a FAIL: message if test fails but no SUCCESS: message
    !    if test passes
    call unit_check(&#146;one&#146;,i &gt; 0,msg=&#146;I &gt; 0&#146;)
<P>
    ! using ANY(3f) and ALL(3f)
    call unit_check(&#146;one&#146;,all([i,j,k] &gt; 0), &
            & &#146;testing if everyone greater than zero&#146;)
    ! display message built of scalars as well
    call unit_check(&#146;one&#146;,all(.not.[i,j,k] == 4), &
            & &#146;for set &#146;,i,j,k,&#146;if no one equals four&#146;)
<P>
    ! for tests that are hard to reduce to a logical test just call
    ! unit_check_bad(3f) if fail
    if(i+j+k &lt; 1)then
       call unit_check_bad(&#146;one&#146;)
    endif
<P>
    call unit_check_end(&#146;one&#146;,&#146;checks on "one" ended&#146;)
    end subroutine test_one
<P>
    subroutine test_two
    ! use of all(3f), any(3f), merge(3f) can be useful
    ! if you know what these would produce
    ! this would return an array, the last element having the value T, else F
    !  write(*,*)[&#146;A&#146;,&#146;X&#146;,&#146;X&#146;,&#146;X&#146;,&#146;X&#146;,&#146;B&#146;] == &#146;B&#146;
    !  write(*,*)all([&#146;A&#146;,&#146;X&#146;,&#146;X&#146;,&#146;X&#146;,&#146;X&#146;,&#146;X&#146;] == &#146;X&#146;) ! this would return F
    !  write(*,*)any([&#146;A&#146;,&#146;X&#146;,&#146;X&#146;,&#146;X&#146;,&#146;X&#146;,&#146;X&#146;] == &#146;B&#146;) ! this would return F
    !  write(*,*)any([&#146;A&#146;,&#146;X&#146;,&#146;X&#146;,&#146;X&#146;,&#146;X&#146;,&#146;B&#146;] == &#146;B&#146;) ! this would return T
    !  write(*,*).not.all(array &lt; 100)
    !  write(*,*)all(array &lt; 100)
    !  ! compare a list. This would return T
    !  write(*,*)all([a,b,c,d] == [21,51,14,45])
    !  ! compare an array. This would return T
    !  write(*,*)all(arr == [21,51,14,45])
    ! you know how valuable ANY(3f) and ALL(3f) will be
    call unit_check_start(&#146;two&#146;,&#146;check on "two" passed&#146;)
    call unit_check(&#146;two&#146;, 1 &gt; 0 .and. &
            & abs(10.10000-10.10001) &lt; 0.0001,msg=&#146;two looks good&#146;)
    call unit_check_end(&#146;two&#146;,&#146;checks on "two" ended&#146;)
    end subroutine test_two
<P>
    end subroutine test_suite_M_demo
<P>
    end module M_framework__demo
<P>
    program demo_M_framework__verify
    use M_framework__demo,   only: test_suite_M_demo
    use M_framework__verify, only: unit_check_mode
       call unit_check_mode(command=&#146;&#146;,flags=[0],keep_going=.true.)
       call test_suite_M_demo()
    end program demo_M_framework__verify
<P>
</PRE>
Expected output:
<P>
<PRE>
    unit_check:       one   SUCCESS:I &gt; 0
    unit_check:       one   SUCCESS:testing if everyone greater than zero
    unit_check:       one   SUCCESS:for set 1 2 3 if no one equals four
    unit_check_end:   one   PASSED   GOOD:3  BAD:0
<P>
    unit_check:       two   SUCCESS:two looks good
    unit_check_end:   two   PASSED   GOOD:1  BAD:0
<P>
</PRE>
</BLOCKQUOTE>
<A name=5>

     <H3>AUTHOR</H3>

</A>
<BLOCKQUOTE>
John S. Urban
</BLOCKQUOTE>
<A name=6>

     <H3>LICENSE</H3>

</A>
<BLOCKQUOTE>
Public Domain
</BLOCKQUOTE>
<P><HR>
<TABLE width=100%><TR> <TD width=33%><I>Nemo Release 3.1</I></TD> <TD width=33% align=center>M_framework__verify (3m_framework__verify)</TD> <TD align=right width=33%><I>April 30, 2023</I></TD> </TR></TABLE><FONT SIZE=-1>Generated by <A HREF="http://www.squarebox.co.uk/download/manServer.shtml">manServer 1.08</A> from 3b3e76b3-c5e9-48f1-af5f-74d339e296e5 using man macros.</FONT>
<br><br><center><img src="images/M_framework__verify.gif"></center>
</div>
</div>
</body>
</HTML>
