<html> 
<head> 
<title> </title>
<style> 
px {font-family: "Lucida Console", Monaco, monospace }
p { font-size:100%; line-height:1.1em; }
body {xfont-style: sans-serif}
body {
color:#333; font-family:Verdana, Arial, Helvetica, sans-serif; font-size:1em; line-height:1.3em; }
a:visited { color:#666; }
h1,h2,h3,h4,h5,h6 { color:#333; font-family:georgia, verdana, sans-serif; }
h1 { font-size:150%; page-break-before:auto;background-color: #aaaaff}
h2 { font-size:143%;color:teal; }
h3 { font-size:134%;color:blue; }
h4 { font-size:120%;color:gray; }
img { max-width: 55em}
p{ padding: 0;margin:0; }
p{ padding-right:1.4em; }
p{ padding-bottom:0.1em; }
p{ padding-top:1em; }
p{ whitespace: pre-wrap; }
h5,h6 { font-size:100% }
a.nav,a:link.nav, a:visited.nav { background-color:#FFF; color:#000; }
XXtable { border:double #000; border-collapse:collapse; }
XXtable { border-collapse:collapse; }
XXtd { border:thin solid #888; }
XXtd { border:none; }
li { margin-bottom:0.5em; }
blockquote { display:block; font-size:100%; line-height:1.1em; margin:0 0 0.5em; padding:0 2.5em; }
pre { background-color:#DDD; font-size:100%; overflow:auto; padding:1em; }
a,li span { color:#000; }
a:hover, a.nav:hover, a:hover math { background-color:#000; color:#FFF; }
#Container { margin:0 10px; text-align:center; background-color: #BBB}
#Content { border-top:none; margin:auto; padding:0.3em; text-align:left; width:100%; max-width:55em; background:#FFF}
span.webName { font-size:.5em; }
textarea#content { font-size: 1em; line-height: 1.125; }
h1#pageName { line-height:1em; margin:0.2em 0 0.2em 0; padding:0; }
.property { color:#666; font-size:100%; }
a.existingWikiWord[title]{ //border: 1px dashed #BBB; }
.byline { color:#666; font-size:1.0em; font-style:italic; margin-bottom:1em; padding-top:1px; } 
</style> 
</head>
<BODY bgcolor=#F0F0F0 text=#000000 link=#0000ff vlink=#C000C0 alink=#ff0000><A NAME=top></A>
<!--
<h5><a href="https://github.com/urbanjost/M_framework__approx">[UP]</a></h5>
<button type="button" onclick="javascript:history.back()">Back</button>
-->
<div id="Container">
<div id="Content">
<CENTER>
<H1><HR><I>Manual Reference Pages &nbsp;-&nbsp;</I><NOBR>compare_float (3m_framework__approx)</NOBR><HR></H1>
</CENTER>
<A name=1>

     <H3>NAME</H3>

</A>
<BLOCKQUOTE>
</BLOCKQUOTE>
<A name=contents></A><H3>CONTENTS</H3></A>
<BLOCKQUOTE>
<A HREF=#1>Name</A><BR>
<A HREF=#2>Synopsis</A><BR>
<A HREF=#3>Description</A><BR>
<A HREF=#4>Details</A><BR>
<A HREF=#5>Options</A><BR>
<A HREF=#6>Result</A><BR>
<A HREF=#7>Operators</A><BR>
<A HREF=#8>Examples</A><BR>
</BLOCKQUOTE>
<A name=9>

     <H3>NAME</H3>

</A>
<BLOCKQUOTE>
compare_float(3f) - [M_framework__approx] compare floating point
values with adjustable tolerance.
(LICENSE:PD)
<P>
</BLOCKQUOTE>
<A name=2>

     <H3>SYNOPSIS</H3>

</A>
<BLOCKQUOTE>
result = compare_float( x, y,ulp = SCALING_VALUE)
<P>
<PRE>
     elemental function (x,y,ulp)
     real(kind=KIND),intent(in) :: x,y
     real|integer,intent(in),optional :: ulp
<P>
</PRE>
Additional convenience operators:
<P>
<PRE>
       X.equalto.Y
       X.lessthan.Y
       X.greaterthan.Y
<P>
</PRE>
</BLOCKQUOTE>
<A name=3>

     <H3>DESCRIPTION</H3>

</A>
<BLOCKQUOTE>
compare_float(3f) is a function for comparing floating point numbers
within an automatically adjusted tolerance.
<P>
The test performed is
<P>
<PRE>
       abs( x - y ) &lt; ( ulp * spacing( max(abs(x),abs(y)) ) )
<P>
</PRE>
If the result is .TRUE., the numbers are considered equal.
Both single and double precision scalar and array numbers can
be compared, as the function is elemental.
<P>
As a convenience relational operators .EqualTo., .GreaterThan.,
and .LessThan. are provided. These are based on the
compare_float(3f) function using the commonly used default
scaling of ULP=1.
</BLOCKQUOTE>
<A name=4>

     <H3>DETAILS</H3>

</A>
<BLOCKQUOTE>
<P>
It is generally acknowledged that real numbers should not be
compared directly but within some tolerance. However, the magnitude
of an appropriate tolerance value will vary depending on the
magnitudes of the numbers being compared and the precision of the
computing environment.
<P>
The Fortran standard does not specify functions or operators
specifically for comparing float values, but leaves some latitude in
how the compilers address floating point comparisions. It does
specify functions that return platform-specific values useful in
applying different methods to the problem such as
<P>
<PRE>
    + digits(3f)        - Significant digits in the numeric model
    + epsilon(3f)       - Epsilon function
    + exponent(3f)      - Exponent of floating-point number
    + fraction(3f)      - Fractional part of the model representation
    + huge(3f)          - Largest number of a type and kind
    + maxexponent(3f)   - Maximum exponent of a real kind
    + minexponent(3f)   - Minimum exponent of a real kind
    + nearest(3f)       - Nearest representable number
    + precision(3f)     - Decimal precision of a real kind
    + radix(3f)         - Base of a numeric model
    + range(3f)         - Decimal exponent range of a numeric kind
    + rrspacing(3f)     - Reciprocal of the relative spacing of a numeric type
    + scale(3f)         - Scale a real value by a whole power of the radix
    + set_exponent(3f)  - real value with specified exponent
    + spacing(3f)       - Smallest distance between two numbers of a given type
    + tiny(3f)          - Smallest positive number of a real kind
<P>
</PRE>
Books have been written on the behavior of floating point math.
<P>
As is used here, a commonly used simple general floating point
comparison algorithm is
<P>
<PRE>
       if(abs(x &lt; y) &lt; (ulp * spacing(max(abs(x),abs(y))))) then
         :
       endif
<P>
</PRE>
where the intrinsic function SPACING(3f) determines the distance
between the argument X and the nearest adjacent representable number
of the same type and ULP is an optional user-supplied scaling factor.
</BLOCKQUOTE>
<A name=5>

     <H3>OPTIONS</H3>

</A>
<BLOCKQUOTE>
<P>
<TABLE cellpadding=3>
<TR valign=top><TD width=6% nowrap>
<B>x,y</B> </TD><TD valign=bottom>
Two congruent floating point values to compare.
</TD></TR>
<TR valign=top><TD width=6% nowrap>
<B>ulp</B> </TD><TD valign=bottom>
The ULP ("unit in the last place") scaling value allows for
users to control the scaling of the value returned by SPACING(3f)
in order to relax or tighten what is considered "equal". That
is, the ULP value can be used to scale the comparison based
on knowledge of the "numerical quality" of the values being used
in the comparision.
<P>
The value should be positive. The absolute value of the value is
taken if it is negative.
<P>
The default ULP scaling value is 1.0.
<P>
The value may be of type integer or real.
<P>
A 0.5 ULP maximum error is the best you could hope for, since
this corresponds to always rounding to the nearest representable
floating point number.
</TD></TR>
<TR></TR></TABLE></BLOCKQUOTE>
<A name=6>

     <H3>RESULT</H3>

</A>
<BLOCKQUOTE>
<P>
The return value is a logical value indicating whether the inputs
are equal to within the requested precision.
</BLOCKQUOTE>
<A name=7>

     <H3>OPERATORS</H3>

</A>
<BLOCKQUOTE>
<P>
Additional operators based on compare_float(3f) are included:
<TABLE cellpadding=3><!-- tsb: Additional operators based on compare_float(3f) are included:
 -->
<TR></TR><TR></TR>
<TR valign=top><TD colspan=2>
<B>X.equalto.Y</B> </TD></TR><TR valign=top><TD width=6%>&nbsp;</TD><TD>
If the result is .TRUE., the numbers are considered equal.
The test performed is
</TD></TR>
<TR><TD colspan=2>
<PRE>
               abs( x - y ) &lt; spacing( max(abs(x),abs(y)) )
<P>
</PRE>
</TD></TR>
<TR valign=top><TD colspan=2>
<B>X.greaterthan.Y</B> </TD></TR><TR valign=top><TD width=6%>&nbsp;</TD><TD>
If the result is .TRUE., x is considered greater than y.
The result is a logical value indicating whether the
operand x is greater than y by more than the spacing
between representable floating point numbers.
<P>
The test performed is
<P>
<PRE>
                  ( x - y ) &gt;= SPACING( MAX(ABS(x),ABS(y)) )
</PRE>
</TD></TR>
<TR valign=top><TD colspan=2>
<B>X.lessthan.Y</B> </TD></TR><TR valign=top><TD width=6%>&nbsp;</TD><TD>
Test if one operand is less than another.
The result is a logical value indicating whether
the operand x is less than y by more than the
spacing between representable floating point
numbers.
<P>
The test performed is
<P>
<PRE>
                 ( y - x ) &gt;= SPACING( MAX(ABS(x),ABS(y)) )
<P>
</PRE>
If the result is .TRUE., x is considered less than y.
</TD></TR>
<TR></TR></TABLE></BLOCKQUOTE>
<A name=8>

     <H3>EXAMPLES</H3>

</A>
<BLOCKQUOTE>
<P>
use m_compare_float_numbers
real :: x, y
if ( compare_float( x, y, ulp=5.0 ) ) ) then
! what to do when x effectively equals y
endif
<P>
For no ULP scaling (ULP=1.0), the relational operators can be used
instead
<P>
use m_compare_float_numbers
real :: x, y
if ( x .equalto. y ) then
! -- x effectively equals y, so perform some operation
&#46;&#46;&#46;.
endif
</BLOCKQUOTE>
<P><HR>
<TABLE width=100%><TR> <TD width=33%><I>Nemo Release 3.1</I></TD> <TD width=33% align=center>compare_float (3m_framework__approx)</TD> <TD align=right width=33%><I>August 31, 2024</I></TD> </TR></TABLE><FONT SIZE=-1>Generated by <A HREF="http://www.squarebox.co.uk/download/manServer.shtml">manServer 1.08</A> from bbd767c1-a07d-4536-8fcc-75dcc5763723 using man macros.</FONT>
<br><br><center><img src="images/compare_float.gif"></center>
</div>
</div>
</body>
</HTML>
